<%- include('../partials/store-head.ejs') %>
<style>

  .stripe {
    width: 140px;
    margin-left: 30px;
    /* float: right; */
  }
  input[type="checkbox"] {
    margin-right: 10px;
  }

</style>

<h1>Contact Information</h1>
<%- include('../partials/validatable-input.ejs', { label: 'First name' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'Last name' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'Email' }) %>

<h1>Shipping Address</h1>
<%- include('../partials/validatable-input.ejs', { label: 'Country', options: countryCodes }) %>

<%- include('../partials/validatable-input.ejs', { label: 'State' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'City' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'Address', help: 'The format you should use is the following: [Street name] [House/flat number] [Unit number]' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'Zip code', name: 'zip', help: 'A 5 digits code that uniquely identifies a geographic area' }) %> 
<p>
  <input type="checkbox" id="remember" checked><label for="remember">Remember my shipping address in this device</label>
</p>
<h1>Card details</h1>
<%- include('../partials/validatable-input.ejs', { label: 'Card number', name: 'number' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'Expiration date (MM/YY)', name: 'cardExpiration' }) %> 
<%- include('../partials/validatable-input.ejs', { label: 'CVC', name: 'number', help: 'A 3 digits code, usually displayed at the back of the card' }) %> 

<div class="errorMessage"></div>

<button id="checkout-button" class="primary" onclick="pay()">Pay</button>

<img class="stripe" src="/assets/stripe.svg" alt="Powered by Stripe">

<!-- MANO: I believe we are not using Stripe here -->
<script src="https://js.stripe.com/v3/"></script>

<script src="/scripts/utils.js" async></script>
<script async>
  // MANO: I believe we are not using Stripe here
  var stripe = Stripe('pk_test_51Hsv6KLzpNoJw5cRqsZQiQh1hqWafCluHiYVFIt68Y4RjWYsEFX4HGPaquJ3lcxNjOh393Ms39m0V4akBZ46727J00EzprcXql');

  function pay () {

    const checkoutParams = {
      firstName: $('#firstName').val(),
      lastName: $('#lastName').val(),
      email: $('#email').val(),
      phone: $('#phone').val(),
      country: $('#country').val(),
      state: $('#state').val(),
      city: $('#city').val(),
      zip: $('#zip').val(),
      number: $('#number').val(),
      exp_month: $('#exp_month').val(),
      exp_year: $('#exp_year').val(),
      cvc: $('#cvc').val(),
      _csrf: '<%= csrfToken %>',
      remember: $('#remember').is(":checked")
    }

    fetchApi('/api/cart/checkout', { // POST is the default method
      params: checkoutParams,
      success: function (data) {
        window.location.replace('/cart/checkout/success')
      }
    })
  }

  $('.validatable-input input').keydown(event => {
    $(event.target).parent().parent().removeClass('error')
  })
</script>

<%- include('../partials/store-tail.ejs') %>

